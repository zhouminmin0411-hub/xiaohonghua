# äº‘å‡½æ•°éƒ¨ç½²æŒ‡å— - å°çº¢èŠ±é¡¹ç›®

**ç¯å¢ƒIDï¼š** `cloud1-6gmt7m654faa5008`  
**åˆ›å»ºæ—¶é—´ï¼š** 2025-12-23

---

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºäº‘æ•°æ®åº“é›†åˆï¼ˆ20åˆ†é’Ÿï¼‰

1. **æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°**
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
   - ç‚¹å‡»"äº‘å¼€å‘"æŒ‰é’®
   - è¿›å…¥æ§åˆ¶å°

2. **ç‚¹å‡»"æ•°æ®åº“"æ ‡ç­¾**

3. **åˆ›å»ºä»¥ä¸‹é›†åˆ**ï¼ˆæŒ‰é¡ºåºåˆ›å»ºï¼‰ï¼š

| é›†åˆåç§° | è¯´æ˜ | éœ€è¦åˆ›å»ºçš„ç´¢å¼• |
|---------|------|--------------|
| `users` | ç”¨æˆ·ä¿¡æ¯ | `openid`ï¼ˆå”¯ä¸€ï¼‰ |
| `tasks` | ä»»åŠ¡åˆ—è¡¨ | `is_active`, `type` |
| `rewards` | å¥–å“åˆ—è¡¨ | `is_active`, `cost` |
| `task_records` | ä»»åŠ¡è®°å½• | `child_id`, `task_id`, `status` |
| `reward_records` | å…‘æ¢è®°å½• | `child_id`, `reward_id` |
| `point_history` | ç§¯åˆ†å†å² | `child_id`, `created_at` |
| `weekly_configs` | å‘¨ç§¯åˆ†é…ç½® | æ—  |

**æ“ä½œæ­¥éª¤ï¼š**
- ç‚¹å‡»"æ·»åŠ é›†åˆ"
- è¾“å…¥é›†åˆåç§°
- ç‚¹å‡»ç¡®å®š
- é‡å¤ä»¥ä¸Šæ­¥éª¤åˆ›å»ºæ‰€æœ‰é›†åˆ

---

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ åˆå§‹æ•°æ®ï¼ˆ10åˆ†é’Ÿï¼‰

#### 1. tasks é›†åˆ - æ·»åŠ é»˜è®¤ä»»åŠ¡

ç‚¹å‡» `tasks` é›†åˆ â†’ æ·»åŠ è®°å½•ï¼Œæ·»åŠ ä»¥ä¸‹æ•°æ®ï¼š

```json
{
  "type": "daily",
  "icon": "ğŸ“š",
  "title": "å®Œæˆä½œä¸š",
  "description": "è®¤çœŸå®Œæˆå½“å¤©çš„ä½œä¸š",
  "reward": 5,
  "time_estimate": "30åˆ†é’Ÿ",
  "created_by_parent_id": null,
  "is_active": true,
  "created_at": new Date(),
  "updated_at": new Date()
}
```

```json
{
  "type": "daily",
  "icon": "ğŸ¦·",
  "title": "æ—©æ™šåˆ·ç‰™",
  "description": "æ—©ä¸Šå’Œæ™šä¸Šå„åˆ·ä¸€æ¬¡ç‰™",
  "reward": 3,
  "time_estimate": "5åˆ†é’Ÿ",
  "created_by_parent_id": null,
  "is_active": true,
  "created_at": new Date(),
  "updated_at": new Date()
}
```

```json
{
  "type": "housework",
  "icon": "ğŸ§¹",
  "title": "æ•´ç†æˆ¿é—´",
  "description": "æŠŠè‡ªå·±çš„æˆ¿é—´æ”¶æ‹¾æ•´é½",
  "reward": 10,
  "time_estimate": "15åˆ†é’Ÿ",
  "created_by_parent_id": null,
  "is_active": true,
  "created_at": new Date(),
  "updated_at": new Date()
}
```

#### 2. rewards é›†åˆ - æ·»åŠ é»˜è®¤å¥–å“

ç‚¹å‡» `rewards` é›†åˆ â†’ æ·»åŠ è®°å½•ï¼š

```json
{
  "icon": "ğŸ¦",
  "title": "å†°æ·‡æ·‹",
  "description": "ä¸€æ”¯å–œæ¬¢çš„å†°æ·‡æ·‹",
  "cost": 20,
  "stock": null,
  "created_by_parent_id": null,
  "is_active": true,
  "created_at": new Date(),
  "updated_at": new Date()
}
```

```json
{
  "icon": "ğŸ¬",
  "title": "çœ‹ç”µå½±",
  "description": "å‘¨æœ«å»ç”µå½±é™¢çœ‹ç”µå½±",
  "cost": 50,
  "stock": null,
  "created_by_parent_id": null,
  "is_active": true,
  "created_at": new Date(),
  "updated_at": new Date()
}
```

```json
{
  "icon": "ğŸ“±",
  "title": "ç©æ¸¸æˆ30åˆ†é’Ÿ",
  "description": "å¯ä»¥ç©30åˆ†é’Ÿå–œæ¬¢çš„æ¸¸æˆ",
  "cost": 30,
  "stock": null,
  "created_by_parent_id": null,
  "is_active": true,
  "created_at": new Date(),
  "updated_at": new Date()
}
```

---

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºäº‘å‡½æ•°ç›®å½•ç»“æ„

1. **åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `cloudfunctions` æ–‡ä»¶å¤¹**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

2. **åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š**
   - å³é”®ç‚¹å‡» `cloudfunctions` æ–‡ä»¶å¤¹
   - é€‰æ‹©"æ›´å¤šè®¾ç½®" â†’ "é€‰æ‹©äº‘å¼€å‘ç¯å¢ƒ"
   - é€‰æ‹©ï¼š`cloud1-6gmt7m654faa5008`

---

### ç¬¬å››æ­¥ï¼šåˆ›å»ºå¹¶éƒ¨ç½²äº‘å‡½æ•°

æˆ‘å·²ç»ä¸ºæ‚¨å‡†å¤‡å¥½äº†ä»¥ä¸‹äº‘å‡½æ•°ä»£ç ï¼ˆåœ¨ `/Users/xila/xiaohonghua/äº‘å‡½æ•°ä»£ç åŒ…/` ç›®å½•ï¼‰ï¼š

#### æ ¸å¿ƒäº‘å‡½æ•°åˆ—è¡¨ï¼š

1. âœ… `login` - ç”¨æˆ·ç™»å½•
2. âœ… `getTasks` - è·å–ä»»åŠ¡åˆ—è¡¨
3. âœ… `receiveTask` - é¢†å–ä»»åŠ¡
4. âœ… `completeTask` - å®Œæˆä»»åŠ¡
5. âœ… `getCurrentPoints` - è·å–å½“å‰ç§¯åˆ†
6. âœ… `getRewards` - è·å–å¥–å“åˆ—è¡¨

#### éƒ¨ç½²æ­¥éª¤ï¼ˆæ¯ä¸ªäº‘å‡½æ•°ï¼‰ï¼š

**æ–¹æ³•1ï¼šé€šè¿‡å¼€å‘è€…å·¥å…·ï¼ˆæ¨èï¼‰**

1. **åœ¨ `cloudfunctions` ç›®å½•å³é”®** â†’ **æ–°å»º Node.js äº‘å‡½æ•°**
2. **è¾“å…¥å‡½æ•°å**ï¼ˆå¦‚ `login`ï¼‰
3. **æ›¿æ¢ `index.js` å†…å®¹**
   - æ‰“å¼€ `/Users/xila/xiaohonghua/äº‘å‡½æ•°ä»£ç åŒ…/login/index.js`
   - å¤åˆ¶å…¨éƒ¨å†…å®¹
   - ç²˜è´´åˆ°æ–°åˆ›å»ºçš„äº‘å‡½æ•°çš„ `index.js`
4. **æ›¿æ¢ `package.json` å†…å®¹**
   - æ‰“å¼€ `/Users/xila/xiaohonghua/äº‘å‡½æ•°ä»£ç åŒ…/login/package.json`
   - å¤åˆ¶å…¨éƒ¨å†…å®¹
   - ç²˜è´´åˆ°äº‘å‡½æ•°çš„ `package.json`
5. **å³é”®äº‘å‡½æ•°æ–‡ä»¶å¤¹** â†’ **ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–**
6. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**

**é‡å¤ä»¥ä¸Šæ­¥éª¤åˆ›å»ºæ‰€æœ‰äº‘å‡½æ•°ï¼**

---

**æ–¹æ³•2ï¼šå¿«é€Ÿå¤åˆ¶ï¼ˆæ›´å¿«ï¼‰**

```bash
# åœ¨ç»ˆç«¯æ‰§è¡Œ
cd /Users/xila/xiaohonghua

# å¤åˆ¶æ‰€æœ‰äº‘å‡½æ•°åˆ°é¡¹ç›®
cp -r äº‘å‡½æ•°ä»£ç åŒ…/* miniprogram/cloudfunctions/

# ç„¶ååœ¨å¼€å‘è€…å·¥å…·ä¸­é€ä¸ªå³é”®ä¸Šä¼ éƒ¨ç½²
```

---

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•äº‘å‡½æ•°

éƒ¨ç½²å®Œæˆåï¼Œæµ‹è¯•äº‘å‡½æ•°æ˜¯å¦æ­£å¸¸ï¼š

1. **åœ¨äº‘å¼€å‘æ§åˆ¶å°** â†’ **äº‘å‡½æ•°**
2. **é€‰æ‹©ä¸€ä¸ªäº‘å‡½æ•°**ï¼ˆå¦‚ `login`ï¼‰
3. **ç‚¹å‡»"äº‘ç«¯æµ‹è¯•"**
4. **è¾“å…¥æµ‹è¯•å‚æ•°**ï¼ˆå¦‚æœéœ€è¦ï¼‰
5. **ç‚¹å‡»"æµ‹è¯•"**
6. **æŸ¥çœ‹è¿”å›ç»“æœ**

**ç¤ºä¾‹æµ‹è¯•ï¼š**

æµ‹è¯• `getTasks`ï¼š
- å‚æ•°ï¼š`{}`ï¼ˆç©ºå¯¹è±¡ï¼‰
- åº”è¿”å›ï¼šä»»åŠ¡åˆ—è¡¨æ•°ç»„

æµ‹è¯• `getCurrentPoints`ï¼š
- å‚æ•°ï¼š`{"childId": "test-id"}`
- åº”è¿”å›ï¼š`{"code": 200, "data": {"points": 0}}`

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

### æ•°æ®åº“ï¼š
- [ ] åˆ›å»º `users` é›†åˆ
- [ ] åˆ›å»º `tasks` é›†åˆ
- [ ] åˆ›å»º `rewards` é›†åˆ
- [ ] åˆ›å»º `task_records` é›†åˆ
- [ ] åˆ›å»º `reward_records` é›†åˆ
- [ ] åˆ›å»º `point_history` é›†åˆ
- [ ] åˆ›å»º `weekly_configs` é›†åˆ
- [ ] æ·»åŠ é»˜è®¤ä»»åŠ¡æ•°æ®
- [ ] æ·»åŠ é»˜è®¤å¥–å“æ•°æ®

### äº‘å‡½æ•°ï¼š
- [ ] åˆ›å»ºå¹¶éƒ¨ç½² `login`
- [ ] åˆ›å»ºå¹¶éƒ¨ç½² `getTasks`
- [ ] åˆ›å»ºå¹¶éƒ¨ç½² `receiveTask`
- [ ] åˆ›å»ºå¹¶éƒ¨ç½² `completeTask`
- [ ] åˆ›å»ºå¹¶éƒ¨ç½² `getCurrentPoints`
- [ ] åˆ›å»ºå¹¶éƒ¨ç½² `getRewards`
- [ ] æµ‹è¯•æ‰€æœ‰äº‘å‡½æ•°

---

## ğŸ¯ å®Œæˆåçš„ä¸‹ä¸€æ­¥

æ•°æ®åº“å’Œäº‘å‡½æ•°éƒ¨ç½²å®Œæˆåï¼š

1. âœ… ä¿®æ”¹å°ç¨‹åºä»£ç ï¼ˆè°ƒç”¨äº‘å‡½æ•°ï¼‰
2. âœ… æœ¬åœ°æµ‹è¯•
3. âœ… çœŸæœºæµ‹è¯•
4. âœ… ä¸Šä¼ ä»£ç å¹¶æäº¤å®¡æ ¸

---

## ğŸ’¡ æç¤º

### ç¯å¢ƒIDé…ç½®
æ‰€æœ‰äº‘å‡½æ•°ä¸­çš„ç¯å¢ƒIDéƒ½å·²è®¾ç½®ä¸ºï¼š`cloud1-6gmt7m654faa5008`

å¦‚æœæ‚¨çš„ç¯å¢ƒIDä¸åŒï¼Œéœ€è¦åœ¨æ¯ä¸ªäº‘å‡½æ•°çš„ `index.js` ä¸­ä¿®æ”¹ï¼š
```javascript
cloud.init({
  env: 'æ‚¨çš„ç¯å¢ƒID'
})
```

### éƒ¨ç½²é¡ºåºå»ºè®®
å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºéƒ¨ç½²å’Œæµ‹è¯•ï¼š
1. login
2. getTasks  
3. getCurrentPoints
4. getRewards
5. receiveTask
6. completeTask

è¿™æ ·å¯ä»¥é€æ­¥éªŒè¯åŠŸèƒ½ï¼

---

**ç°åœ¨å¼€å§‹åˆ›å»ºæ•°æ®åº“é›†åˆå§ï¼** ğŸš€

