# 小红花项目 - AI开发规则

## 🚨 遇到后端编译或启动错误时的处理流程

### 第一步：先分析，不要急于修改配置

当遇到后端服务无法启动或编译错误时：

1. **优先检查环境问题**，而不是修改代码或配置
2. **如果之前能正常运行，现在出问题 → 99%是环境变化**
3. **查看详细规则**: 项目根目录有 `.rule` 文件，包含完整的故障排查指南

### 第二步：Java版本检查（最常见问题）

**症状：**
- 编译错误：`Fatal error compiling: java.lang.ExceptionInInitializerError`
- Maven报错：`TypeTag :: UNKNOWN`

**原因：** 本项目需要 **Java 21**，系统可能切换到了其他版本

**解决方案：**
```bash
# 1. 检查当前版本
java -version

# 2. 如果不是21，切换到Java 21
export JAVA_HOME=/opt/homebrew/opt/openjdk@21
export PATH=$JAVA_HOME/bin:$PATH

# 3. 启动服务
cd backend
mvn spring-boot:run
```

**❌ 禁止的做法：**
- ❌ 不要将pom.xml中的Java版本从21降级到17
- ❌ 不要修改项目的Java版本配置

### 第三步：其他常见问题

**端口占用（Port 8081 is already in use）：**
```bash
lsof -i :8081  # 查找占用进程
kill -9 <PID>  # 终止进程
```

**数据库连接问题：**
```bash
brew services list | grep mysql
brew services start mysql  # 如果未运行
```

**小程序"request:fail"错误：**
- 原因：后端服务未启动
- 解决：先确保后端在8081端口正常运行
- 测试：`curl http://localhost:8081/api/auth/login`

## 📋 故障排查优先级

遇到问题时，**必须按此顺序排查**：

1. ✅ 检查Java版本 (`java -version`)
2. ✅ 检查后端服务状态 (`lsof -i :8081`)
3. ✅ 检查数据库连接
4. ✅ 查看服务日志
5. ✅ 清理重新编译 (`mvn clean package`)

## 🎯 开发规范

### 后端启动标准命令
```bash
cd /Users/xila/xiaohonghua/backend
export JAVA_HOME=/opt/homebrew/opt/openjdk@21
export PATH=$JAVA_HOME/bin:$PATH
mvn spring-boot:run
```

### 重要提醒
- ⚠️ **在修改任何配置文件之前，先查看 `.rule` 文件中的详细说明**
- ⚠️ **不要猜测问题，先收集信息（日志、版本、状态）**
- ⚠️ **之前能运行的配置不要轻易修改**

---

**详细文档**: 查看项目根目录的 `.rule` 文件获取完整故障排查指南

