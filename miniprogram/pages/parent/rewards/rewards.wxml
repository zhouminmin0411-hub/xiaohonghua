<!--家长奖励管理页面-->
<view class="container">
  <view class="header">
    <view class="header-title">奖励管理</view>
    <view class="add-btn" bind:tap="showAddReward">
      <text class="add-icon">+</text>
      <text>新建奖励</text>
    </view>
  </view>

  <view class="rewards-section">
    <view class="section-bar">
      <view class="section-title">
        <text class="section-name">奖励列表</text>
        <text class="section-tip">整理孩子可兑换的奖励项</text>
      </view>
      <view class="count-pill">共 {{rewards.length}} 个</view>
    </view>

    <view wx:if="{{rewards.length === 0}}" class="empty-state">
      <text class="empty-icon">🎁</text>
      <text class="empty-text">暂无奖励，点击上方按钮新建</text>
    </view>

    <view wx:else class="reward-list">
      <view 
        wx:for="{{rewards}}" 
        wx:key="id" 
        class="reward-item"
      >
        <view class="reward-main">
          <view class="reward-icon">{{item.icon}}</view>
          <view class="reward-info">
            <view class="reward-name">{{item.title}}</view>
            <view class="reward-meta">
              <view class="reward-type {{item.type === 'virtual' ? 'type-virtual' : 'type-physical'}}">
                {{rewardTypeMap[item.type]}}
              </view>
              <view class="reward-cost">消耗 {{item.cost}} 小红花</view>
            </view>
          </view>
        </view>

        <view class="reward-actions">
          <view class="action-btn edit-btn" bind:tap="editReward" data-reward="{{item}}">
            编辑
          </view>
          <view class="action-btn delete-btn" bind:tap="deleteReward" data-id="{{item.id}}">
            删除
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 新建/编辑奖励弹窗 -->
  <van-popup show="{{showPopup}}" position="bottom" custom-style="height: 75%; border-radius: 32rpx 32rpx 0 0;">
    <view class="popup-content">
      <view class="popup-header">
        <view class="popup-title">{{editingReward ? '编辑奖励' : '新建奖励'}}</view>
        <view class="popup-close" bind:tap="hidePopup">✕</view>
      </view>

      <view class="form">
        <van-field
          label="奖励图标"
          value="{{formData.icon}}"
          placeholder="选择一个Emoji图标"
          bind:change="onIconChange"
        />

        <van-field
          label="奖励名称"
          value="{{formData.title}}"
          placeholder="请输入奖励名称"
          bind:change="onTitleChange"
          required
        />

        <van-field
          label="奖励类型"
          value="{{rewardTypeMap[formData.type]}}"
          placeholder="请选择奖励类型"
          readonly
          is-link
          bind:tap="showTypePicker"
        />

        <van-field
          label="消耗积分"
          value="{{formData.cost}}"
          placeholder="请输入消耗积分"
          type="number"
          bind:change="onCostChange"
          required
        />

        <view class="form-actions">
          <view class="form-btn cancel-btn" bind:tap="hidePopup">取消</view>
          <view class="form-btn submit-btn" bind:tap="submitReward">
            {{editingReward ? '保存' : '创建'}}
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- 奖励类型选择器 -->
  <van-popup show="{{showTypePopup}}" position="bottom">
    <van-picker
      columns="{{typeColumns}}"
      bind:confirm="onTypeConfirm"
      bind:cancel="onTypeCancel"
    />
  </van-popup>
</view>
