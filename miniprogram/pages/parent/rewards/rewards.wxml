<!--å®¶é•¿å¥–åŠ±ç®¡ç†é¡µé¢-->
<view class="container">
  <view class="header">
    <view class="header-title">å¥–åŠ±ç®¡ç†</view>
    <view class="add-btn" bind:tap="showAddReward">
      <text class="add-icon">+</text>
      <text>æ–°å»ºå¥–åŠ±</text>
    </view>
  </view>

  <view class="rewards-section">
    <view class="section-bar">
      <view class="section-title">
        <text class="section-name">å¥–åŠ±åˆ—è¡¨</text>
        <text class="section-tip">æ•´ç†å­©å­å¯å…‘æ¢çš„å¥–åŠ±é¡¹</text>
      </view>
      <view class="count-pill">å…± {{rewards.length}} ä¸ª</view>
    </view>

    <view wx:if="{{rewards.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ</text>
      <text class="empty-text">æš‚æ— å¥–åŠ±ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ–°å»º</text>
    </view>

    <view wx:else class="reward-list">
      <view 
        wx:for="{{rewards}}" 
        wx:key="id" 
        class="reward-item"
      >
        <view class="reward-main">
          <view class="reward-icon">{{item.icon}}</view>
          <view class="reward-info">
            <view class="reward-name">{{item.title}}</view>
            <view class="reward-meta">
              <view class="reward-type {{item.type === 'virtual' ? 'type-virtual' : 'type-physical'}}">
                {{rewardTypeMap[item.type]}}
              </view>
              <view class="reward-cost">æ¶ˆè€— {{item.cost}} å°çº¢èŠ±</view>
            </view>
          </view>
        </view>

        <view class="reward-actions">
          <view class="action-btn edit-btn" bind:tap="editReward" data-reward="{{item}}">
            ç¼–è¾‘
          </view>
          <view class="action-btn delete-btn" bind:tap="deleteReward" data-id="{{item.id}}">
            åˆ é™¤
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ–°å»º/ç¼–è¾‘å¥–åŠ±å¼¹çª— -->
  <van-popup show="{{showPopup}}" position="bottom" custom-style="height: 75%; border-radius: 32rpx 32rpx 0 0;">
    <view class="popup-content">
      <view class="popup-header">
        <view class="popup-title">{{editingReward ? 'ç¼–è¾‘å¥–åŠ±' : 'æ–°å»ºå¥–åŠ±'}}</view>
        <view class="popup-close" bind:tap="hidePopup">âœ•</view>
      </view>

      <view class="form">
        <van-field
          label="å¥–åŠ±å›¾æ ‡"
          value="{{formData.icon}}"
          placeholder="é€‰æ‹©ä¸€ä¸ªEmojiå›¾æ ‡"
          bind:change="onIconChange"
        />

        <van-field
          label="å¥–åŠ±åç§°"
          value="{{formData.title}}"
          placeholder="è¯·è¾“å…¥å¥–åŠ±åç§°"
          bind:change="onTitleChange"
          required
        />

        <van-field
          label="å¥–åŠ±ç±»å‹"
          value="{{rewardTypeMap[formData.type]}}"
          placeholder="è¯·é€‰æ‹©å¥–åŠ±ç±»å‹"
          readonly
          is-link
          bind:tap="showTypePicker"
        />

        <van-field
          label="æ¶ˆè€—ç§¯åˆ†"
          value="{{formData.cost}}"
          placeholder="è¯·è¾“å…¥æ¶ˆè€—ç§¯åˆ†"
          type="number"
          bind:change="onCostChange"
          required
        />

        <view class="form-actions">
          <view class="form-btn cancel-btn" bind:tap="hidePopup">å–æ¶ˆ</view>
          <view class="form-btn submit-btn {{submitting ? 'is-disabled' : ''}}" bind:tap="submitReward">
            {{submitting ? 'ä¿å­˜ä¸­...' : (editingReward ? 'ä¿å­˜' : 'åˆ›å»º')}}
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- å¥–åŠ±ç±»å‹é€‰æ‹©å™¨ï¼ˆè‡ªå®šä¹‰ï¼‰ -->
  <view wx:if="{{showTypePicker}}" class="type-picker-mask" bind:tap="onTypeCancel">
    <view class="type-picker-sheet" catch:tap="noop">
      <view class="type-picker-header">
        <text class="type-picker-cancel" bind:tap="onTypeCancel">å–æ¶ˆ</text>
        <text class="type-picker-title">å¥–åŠ±ç±»å‹</text>
        <text class="type-picker-confirm" bind:tap="onTypeConfirm">ç¡®å®š</text>
      </view>
      <picker-view
        class="type-picker-view"
        indicator-style="height: 88rpx;"
        value="{{[tempTypeIndex]}}"
        bindchange="onTypePickerChange"
      >
        <picker-view-column>
          <view class="type-picker-item" wx:for="{{typeColumns}}" wx:key="value">
            {{item.text}}
          </view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>
</view>
