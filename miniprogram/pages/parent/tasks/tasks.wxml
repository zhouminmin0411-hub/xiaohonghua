<!--å®¶é•¿ä»»åŠ¡ç®¡ç†é¡µé¢-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-title">ä»»åŠ¡ç®¡ç†</view>
    <view class="add-btn" bind:tap="showAddTask">
      <text class="add-icon">+</text>
      <text>æ–°å»ºä»»åŠ¡</text>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="tasks-section">
    <view wx:if="{{tasks.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ–°å»º</text>
    </view>

    <view wx:else class="task-list">
      <view 
        wx:for="{{tasks}}" 
        wx:key="id" 
        class="task-item {{!item.isActive ? 'task-disabled' : ''}}"
      >
        <view class="task-main">
          <view class="task-icon">{{item.icon}}</view>
          <view class="task-info">
            <view class="task-name">{{item.title}}</view>
            <view class="task-meta">
              <view class="task-type">{{taskTypeMap[item.type]}}</view>
              <view class="task-reward">å¥–åŠ±ï¼š{{item.reward}} å°çº¢èŠ±</view>
            </view>
            <view wx:if="{{item.description}}" class="task-desc">{{item.description}}</view>
          </view>
        </view>

        <view class="task-actions">
          <view class="action-btn edit-btn" bind:tap="editTask" data-task="{{item}}">
            ç¼–è¾‘
          </view>
          <view class="action-btn delete-btn" bind:tap="deleteTask" data-id="{{item.id}}">
            åˆ é™¤
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ–°å»º/ç¼–è¾‘ä»»åŠ¡å¼¹çª— -->
  <van-popup show="{{showPopup}}" position="bottom" custom-style="height: 75%; border-radius: 32rpx 32rpx 0 0;">
    <view class="popup-content">
      <view class="popup-header">
        <view class="popup-title">{{editingTask ? 'ç¼–è¾‘ä»»åŠ¡' : 'æ–°å»ºä»»åŠ¡'}}</view>
        <view class="popup-close" bind:tap="hidePopup">âœ•</view>
      </view>

      <view class="form">
        <van-field
          label="ä»»åŠ¡å›¾æ ‡"
          value="{{formData.icon}}"
          placeholder="é€‰æ‹©ä¸€ä¸ªEmojiå›¾æ ‡"
          bind:change="onIconChange"
        />

        <van-field
          label="ä»»åŠ¡åç§°"
          value="{{formData.title}}"
          placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°"
          bind:change="onTitleChange"
          required
        />

        <van-field
          label="ä»»åŠ¡æè¿°"
          value="{{formData.description}}"
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆé€‰å¡«ï¼‰"
          type="textarea"
          autosize
          bind:change="onDescriptionChange"
        />

        <van-field
          label="ä»»åŠ¡ç±»å‹"
          value="{{taskTypeMap[formData.type]}}"
          placeholder="è¯·é€‰æ‹©ä»»åŠ¡ç±»å‹"
          readonly
          is-link
          bind:tap="showTypePicker"
        />

        <van-field
          label="å¥–åŠ±ç§¯åˆ†"
          value="{{formData.reward}}"
          placeholder="è¯·è¾“å…¥å¥–åŠ±ç§¯åˆ†"
          type="number"
          bind:change="onRewardChange"
          required
        />

        <view class="form-actions">
          <view class="form-btn cancel-btn" bind:tap="hidePopup">å–æ¶ˆ</view>
          <view class="form-btn submit-btn" bind:tap="submitTask">
            {{editingTask ? 'ä¿å­˜' : 'åˆ›å»º'}}
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- ä»»åŠ¡ç±»å‹é€‰æ‹©å™¨ -->
  <van-popup show="{{showTypePopup}}" position="bottom">
    <van-picker
      columns="{{typeColumns}}"
      bind:confirm="onTypeConfirm"
      bind:cancel="onTypeCancel"
    />
  </van-popup>
</view>

