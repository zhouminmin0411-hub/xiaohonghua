<!--设置页面 · 绘本风 Refined-->
<view class="page-container">
  <!-- 顶部区域 -->
  <view class="header">
    <view class="header-title">设置</view>
  </view>

  <!-- 用户信息卡片 -->
  <view class="user-section">
    <view class="user-card">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-info">
        <view class="nickname">{{userInfo.nickname}}</view>
        <view class="role-badge {{isParentMode ? 'role-parent' : 'role-child'}}">
          {{isParentMode ? '家长模式' : '小朋友模式'}}
        </view>
      </view>
    </view>
  </view>

  <!-- 设置列表 -->
  <view class="settings-list">
    <view 
      class="setting-item"
      bind:tap="onSwitchToParent"
      wx:if="{{!isParentMode}}"
    >
      <view class="setting-icon">👨‍👩‍👧</view>
      <view class="setting-content">
        <text class="setting-title">切换至家长视角</text>
        <text class="setting-desc">管理任务和奖励</text>
      </view>
      <view class="setting-arrow">></view>
    </view>

    <view 
      class="setting-item"
      bind:tap="onExitParentMode"
      wx:else
    >
      <view class="setting-icon">🧸</view>
      <view class="setting-content">
        <text class="setting-title">退出家长视角</text>
        <text class="setting-desc">回到小朋友界面</text>
      </view>
      <view class="setting-arrow">></view>
    </view>

    <view class="setting-item" bind:tap="onAbout">
      <view class="setting-icon">📖</view>
      <view class="setting-content">
        <text class="setting-title">关于小红花</text>
        <text class="setting-desc">版本 1.0.0</text>
      </view>
      <view class="setting-arrow">></view>
    </view>
  </view>

  <!-- 底部导航栏 (基于 Spec 第5章) -->
  <!-- Settings is not a main tab anymore, remove tab bar -->

  <!-- 密码输入弹窗 (自定义样式) -->
  <van-popup 
    show="{{ showPasswordDialog }}" 
    bind:close="onClosePasswordDialog"
    custom-style="background: transparent;"
    closeable
  >
    <view class="password-dialog-card">
      <view class="dialog-title">输入家长密码</view>
      <view class="password-input-area">
        <view class="password-dots">
          <view 
            wx:for="{{4}}" 
            wx:key="index"
            class="password-dot {{password.length > index ? 'filled' : ''}}"
          ></view>
        </view>
      </view>
      <view class="password-keyboard">
        <view class="keyboard-row">
          <view class="key" bind:tap="onKeyPress" data-key="1">1</view>
          <view class="key" bind:tap="onKeyPress" data-key="2">2</view>
          <view class="key" bind:tap="onKeyPress" data-key="3">3</view>
        </view>
        <view class="keyboard-row">
          <view class="key" bind:tap="onKeyPress" data-key="4">4</view>
          <view class="key" bind:tap="onKeyPress" data-key="5">5</view>
          <view class="key" bind:tap="onKeyPress" data-key="6">6</view>
        </view>
        <view class="keyboard-row">
          <view class="key" bind:tap="onKeyPress" data-key="7">7</view>
          <view class="key" bind:tap="onKeyPress" data-key="8">8</view>
          <view class="key" bind:tap="onKeyPress" data-key="9">9</view>
        </view>
        <view class="keyboard-row">
          <view class="key empty"></view>
          <view class="key" bind:tap="onKeyPress" data-key="0">0</view>
          <view class="key delete" bind:tap="onDeleteKey">←</view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- Toast -->
  <van-toast id="van-toast" />
</view>

