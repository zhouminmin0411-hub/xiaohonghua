<!-- 小朋友首页 · 绘本风 Refined -->
<view class="page-container">
  <!-- 顶部区域：头像 & 问候 (已移动到许愿瓶页面) -->
  <view class="header-placeholder" style="height: 20rpx;"></view>



  <!-- 任务列表区域 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">今日任务</text>
      <text class="section-subtitle">完成就能得到小红花</text>
    </view>
    
    <view wx:if="{{tasks.length === 0}}" class="empty-state">
      <text class="empty-icon">📋</text>
      <text class="empty-text">暂无任务，等你来添加哦</text>
    </view>
    
    <view wx:else class="task-list">
      <view 
        wx:for="{{tasks}}" 
        wx:key="id" 
        class="task-card {{item.status === 'completed' ? 'task-completed' : ''}}"
      >
        <!-- 左侧图标 -->
        <view class="task-icon-wrapper">
          <view class="task-icon">{{item.icon || '🎯'}}</view>
        </view>

        <!-- 中间信息 -->
        <view class="task-info">
          <view class="task-title">{{item.title}}</view>
          <view class="task-reward">
            <text>+{{item.reward}}</text>
            <image src="/assets/flower1.png" class="reward-icon-small" mode="aspectFit" />
          </view>
        </view>

        <!-- 右侧按钮 -->
        <view class="task-action">
          <view 
            wx:if="{{item.status === 'available'}}"
            class="action-btn primary-btn"
            bind:tap="onReceiveTask"
            data-id="{{item.id}}"
            id="task-btn-{{item.id}}"
          >
            接取
          </view>
          <view 
            wx:elif="{{item.status === 'received'}}"
            class="action-btn primary-btn"
            bind:tap="onCompleteTask"
            data-id="{{item.id}}"
            data-record-id="{{item.recordId}}"
            data-reward="{{item.reward}}"
            data-title="{{item.title}}"
            id="task-btn-{{item.id}}"
          >
            我做完啦
          </view>
          <view wx:else class="status-text">
            <text>已完成</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 小红花飞入动画 -->
  <view 
    wx:if="{{showFlowerAnimation}}" 
    class="flower-animation"
    style="left: {{flowerX}}px; top: {{flowerY}}px;"
    animation="{{flowerAnimationData}}"
  >
    🌸
  </view>

  <van-toast id="van-toast" />
</view>
