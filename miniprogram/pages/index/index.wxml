<!--å°æœ‹å‹é¦–é¡µ-->
<view class="page">
  <!-- è‹±é›„åŒºåŸŸ -->
  <view class="hero">
    <view class="hero-top">
      <view class="brand">
        <text class="brand-label">å°çº¢èŠ±</text>
        <text class="brand-subtitle">{{greeting}}</text>
      </view>
      <view class="settings-entry" bind:tap="onOpenSettings" hover-class="pressed">
        <text class="settings-icon">âš™ï¸</text>
      </view>
    </view>

    <view class="flower-counter">
      <view class="counter-left">
        <view class="flower-emblem">ğŸŒ¸</view>
        <view class="counter-info">
          <text class="counter-label">å½“å‰å°çº¢èŠ±</text>
          <text class="counter-value">{{currentPoints}}</text>
        </view>
      </view>
      <view class="counter-flash">
        <text>ç»§ç»­ä¿æŒå¥½çŠ¶æ€ï¼</text>
      </view>
    </view>

    <view class="hero-metas">
      <view class="meta-card">
        <text class="meta-label">ä»Šæ—¥ä»»åŠ¡</text>
        <text class="meta-value">{{tasks.length}}</text>
      </view>
      <view class="meta-card">
        <text class="meta-label">å¯é¢†å¥–åŠ±</text>
        <text class="meta-value">+{{totalReward}}ğŸŒ¸</text>
      </view>
      <view class="meta-card">
        <text class="meta-label">å·²å®Œæˆ</text>
        <text class="meta-value">{{completedCount}}</text>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="tasks-section">
    <view class="section-title">
      <text>ä»Šæ—¥ä»»åŠ¡å¾…ä½ æ¢ç´¢</text>
    </view>
    
    <view wx:if="{{tasks.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— ä»»åŠ¡</text>
    </view>
    
    <view wx:else class="task-list">
      <view 
        wx:for="{{tasks}}" 
        wx:key="id" 
        class="task-card {{item.status === 'received' ? 'task-received' : ''}} {{item.status === 'completed' ? 'task-completed' : ''}}"
      >
        <view class="task-card-body">
          <view class="task-icon">{{item.icon}}</view>
          <view class="task-content">
            <view class="task-title-row">
              <text class="task-title">{{item.title}}</text>
              <view class="task-tag">
                {{item.type === 'challenge' ? 'æŒ‘æˆ˜ä»»åŠ¡' : item.type === 'daily' ? 'æ¯æ—¥ä¹ æƒ¯' : 'å®¶åŠ¡ä»»åŠ¡'}}
              </view>
            </view>
            <view class="task-meta-row">
              <view class="task-duration" wx:if="{{item.timeEstimate}}">
                <text class="meta-dot"></text>{{item.timeEstimate}}
              </view>
              <view class="task-reward-pill">+{{item.reward}} å°çº¢èŠ±</view>
            </view>
            <view class="task-description">{{item.description ? item.description : 'å®Œæˆåè®©å®¶é‡Œæ›´æ£’ï¼'}}</view>
          </view>
        </view>

        <view class="task-action-wrapper">
          <view 
            wx:if="{{item.status === 'available'}}"
            class="task-action-btn task-btn-warning"
            bind:tap="onReceiveTask"
            data-id="{{item.id}}"
            id="task-btn-{{item.id}}"
          >
            æ¥å–ä»»åŠ¡
          </view>
          <view 
            wx:elif="{{item.status === 'received'}}"
            class="task-action-btn task-btn-primary"
            bind:tap="onCompleteTask"
            data-id="{{item.id}}"
            data-reward="{{item.reward}}"
            data-title="{{item.title}}"
            id="task-btn-{{item.id}}"
          >
            æˆ‘å®Œæˆå•¦ï¼
          </view>
          <view wx:else class="completed-inline">
            <text class="status-pill status-completed">âœ“ å·²å®Œæˆ</text>
            <text wx:if="{{item.parentLikedAt}}" class="status-pill status-liked">â¤ï¸ å·²ç‚¹èµ</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰æµ®åŠ¨å¯¼èˆª -->
  <view class="floating-nav {{floatingNavHidden ? 'floating-nav-hidden' : ''}}">
    <view 
      class="nav-item active" 
      data-path="/pages/index/index" 
      bind:tap="onNavigateTab"
    >
      <view class="nav-icon">ğŸ¡</view>
      <text>é¦–é¡µ</text>
    </view>
    <view 
      class="nav-item" 
      data-path="/pages/rewards/rewards" 
      bind:tap="onNavigateTab"
    >
      <view class="nav-icon">ğŸ</view>
      <text>ç§¯åˆ†å•†åŸ</text>
    </view>
    <view 
      class="nav-item" 
      data-path="/pages/settings/settings" 
      bind:tap="onNavigateTab"
    >
      <view class="nav-icon">âš™ï¸</view>
      <text>è®¾ç½®</text>
    </view>
  </view>

  <!-- å°çº¢èŠ±é£å…¥åŠ¨ç”» -->
  <view 
    wx:if="{{showFlowerAnimation}}" 
    class="flower-animation"
    style="left: {{flowerX}}px; top: {{flowerY}}px;"
    animation="{{flowerAnimationData}}"
  >
    ğŸŒ¸
  </view>

  <!-- Toastæç¤º -->
  <van-toast id="van-toast" />
</view>
