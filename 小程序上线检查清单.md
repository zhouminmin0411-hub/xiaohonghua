# 小红花小程序上线检查清单

## 📅 创建日期：2025-12-23

---

## 第一阶段：部署准备

### 1. 后端服务部署（已选择：微信云托管 ✅）

**优势：** 免备案、自动HTTPS、按量计费

**快速开始：** 参考《云托管快速开始.md》

**详细步骤：**
- [ ] 开通微信云托管（2分钟）
- [ ] 打包后端代码：`mvn clean package`
- [ ] 上传代码到云托管（通过开发者工具）
- [ ] 等待镜像构建完成（3-10分钟）
- [ ] 开通云数据库（MySQL 8.0）
- [ ] 执行数据库初始化脚本（schema.sql + seed.sql）
- [ ] 配置环境变量（WECHAT_APPID, WECHAT_SECRET）
- [ ] 等待服务启动（1-2分钟）
- [ ] 获取云托管域名（格式：https://xxx.sh.run.tcloudbase.com）
- [ ] 测试后端接口可访问

**参考文档：**
- 快速指南：`云托管快速开始.md`
- 详细指南：`微信云托管部署指南.md`

---

### 2. 微信公众平台域名配置
登录：https://mp.weixin.qq.com/

路径：开发管理 → 开发设置 → 服务器域名

配置以下域名：
- [ ] request合法域名：`https://your-domain.com`
- [ ] uploadFile合法域名：`https://your-domain.com`
- [ ] downloadFile合法域名：`https://your-domain.com`

⚠️ **注意事项：**
- 必须是HTTPS
- 必须已备案
- 不能带端口号
- 每月只能修改5次

---

### 3. 小程序代码修改

#### 修改 `miniprogram/utils/realApi.js`
```javascript
const CONFIG = {
  DEV_BASE_URL: 'http://localhost:8081/api',
  PROD_BASE_URL: 'https://your-domain.com/api',  // ← 改为实际域名
  ENV: 'prod'  // ← 改为 prod
}
```

#### 检查 `project.config.json`
- [ ] 确认 `appid` 正确：`wxe1fef2b88d7ea01e`
- [ ] 确认 `urlCheck` 设置（建议改为 `true`）

---

## 第二阶段：小程序信息完善

### 4. 基本信息
路径：设置 → 基本设置

- [ ] 小程序名称：小红花
- [ ] 小程序头像：上传Logo（建议尺寸：144x144px）
- [ ] 小程序介绍：不超过120字
  ```
  小红花是一款专为家庭设计的儿童任务管理工具。
  通过趣味化的任务系统和积分奖励机制，帮助孩子培养良好习惯，
  让家庭教育更有趣、更有效。
  ```
- [ ] 服务类目：教育 → 在线教育（或生活服务 → 综合生活服务）

---

### 5. 用户隐私保护指引
路径：设置 → 基本设置 → 用户隐私保护指引

需要声明的权限：
- [ ] **用户信息**
  - 用途：用户登录和身份识别
  - 场景：首次进入小程序时
- [ ] **相册（写入）**
  - 用途：保存图片到相册
  - 场景：用户主动保存图片时
- [ ] **选择图片/拍照**
  - 用途：上传用户头像
  - 场景：个人设置页面

参考模板：
```
1. 我们会收集您的微信昵称、头像，用于账号登录和个性化展示
2. 我们会在您主动选择时访问您的相册，用于上传头像图片
3. 我们会在您主动选择时使用相册写入权限，用于保存图片
4. 我们不会收集您的位置信息、通讯录等其他敏感信息
```

---

### 6. 版本管理
路径：管理 → 版本管理

准备版本说明（示例）：
```
版本号：1.0.0
更新内容：
1. 儿童任务管理功能
2. 积分奖励系统
3. 许愿瓶动画展示
4. 奖品兑换功能
5. 家长管理端
```

---

## 第三阶段：代码上传与审核

### 7. 开发者工具上传代码

操作步骤：
1. [ ] 打开微信开发者工具
2. [ ] 确保所有功能测试通过
3. [ ] 点击顶部工具栏「上传」按钮
4. [ ] 填写版本号：`1.0.0`
5. [ ] 填写项目备注：`首次上线版本`
6. [ ] 点击「上传」

---

### 8. 微信公众平台提交审核

登录：https://mp.weixin.qq.com/  
路径：管理 → 版本管理 → 开发版本

1. [ ] 点击「提交审核」
2. [ ] 填写配置信息：
   - **功能页面配置**
     - pages/wishes/wishes：许愿瓶（首页）
     - pages/index/index：任务列表
     - pages/rewards/rewards：奖品兑换
     - pages/parent/home/home：家长管理端
   
3. [ ] 填写测试账号（重要！）
   - 提供一个可用的测试账号和密码
   - 说明测试流程
   
   示例：
   ```
   测试账号：13800138000（或微信号）
   测试密码：test123
   
   测试路径：
   1. 进入小程序，使用微信登录
   2. 查看任务列表
   3. 完成一个任务
   4. 查看积分变化
   5. 进入奖品兑换页面
   6. 点击「家长管理」进入管理端
   ```

4. [ ] 勾选同意《微信小程序平台服务条款》
5. [ ] 点击「提交审核」

---

### 9. 等待审核
- **审核时间：** 通常 1-7 个工作日
- **审核状态查看：** 管理 → 版本管理 → 审核版本

审核可能遇到的问题：
- ❌ 服务类目不符：需重新选择正确类目
- ❌ 内容违规：检查文案是否符合规范
- ❌ 功能缺失：确保提交的页面功能正常
- ❌ 隐私保护不合规：完善隐私保护指引

如果被拒：
1. 查看拒绝原因
2. 根据提示修改
3. 重新上传代码
4. 再次提交审核

---

## 第四阶段：发布上线

### 10. 审核通过后发布

1. [ ] 收到审核通过通知
2. [ ] 登录微信公众平台
3. [ ] 管理 → 版本管理 → 审核通过版本
4. [ ] 点击「发布」按钮
5. [ ] 确认发布

---

### 11. 发布后检查

- [ ] 在微信搜索「小红花」能找到小程序
- [ ] 扫描小程序码能正常打开
- [ ] 所有功能正常运行
- [ ] 接口请求成功
- [ ] 数据正常显示

---

## 第五阶段：后期维护

### 12. 数据监控
路径：统计 → 数据分析

监控指标：
- [ ] 访问次数
- [ ] 访问人数
- [ ] 打开次数
- [ ] 新增用户数
- [ ] 用户留存率

---

### 13. 版本更新流程
当需要更新时：
1. 在开发者工具上传新版本代码
2. 在公众平台提交审核
3. 审核通过后选择「全量发布」或「分阶段发布」

---

## 📝 关键注意事项

### ⚠️ 上线前必须完成
1. ✅ 后端服务必须部署到线上（HTTPS）
2. ✅ 域名必须在微信公众平台配置
3. ✅ 代码中的 `ENV` 必须改为 `prod`
4. ✅ 用户隐私保护指引必须填写

### ⚠️ 审核容易被拒的原因
1. ❌ 服务器域名未配置或配置错误
2. ❌ 功能与服务类目不符
3. ❌ 缺少用户隐私保护说明
4. ❌ 测试账号无法登录或功能异常
5. ❌ 页面出现空白或报错

### ⚠️ 安全建议
1. 生产环境数据库单独部署
2. 定期备份数据
3. 配置CDN加速（如有大量图片）
4. 监控服务器性能和日志

---

## 📞 相关链接

- 微信公众平台：https://mp.weixin.qq.com/
- 微信开发者文档：https://developers.weixin.qq.com/miniprogram/dev/framework/
- 微信云托管文档：https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html
- 审核规范：https://developers.weixin.qq.com/miniprogram/product/

---

## ✅ 当前项目状态

- ✅ 小程序 AppID：`wxe1fef2b88d7ea01e`
- ✅ 小程序名称：小红花
- ✅ 前端代码：已完成
- ✅ 后端服务：本地运行正常
- ⏳ 后端部署：待完成
- ⏳ 域名配置：待完成

---

**预计上线时间：** 完成后端部署后 1-7 天（取决于审核速度）

**建议优先处理：** 后端服务部署（最耗时的环节）

